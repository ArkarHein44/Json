import{c as S,d as h,T as b,a as D,o as q,q as E,b as T,w as L,e as $}from"./authorize-lK45T0jY.js";import"./authcheck-BhddX8Zz.js";/* empty css                */function A(e,t){let r=e,s=t;const n=S(h,"chats");let l=null;const y=async o=>{const a=new Date,c={username:s,room:r,message:o,created_at:b.fromDate(a)};try{return await D(n,c)}catch{throw console.log("Error addChat = ",err),err}},w=o=>{l&&l(),l=q(E(n,L("room","==",r),T("created_at")),a=>{a.docChanges().forEach(c=>{c.type==="added"&&o(c.doc.data())})})},x=o=>{r=o},v=o=>{s=o,localStorage.setItem("username",s)};return(()=>{let o=setInterval(async()=>{try{const a=await getDocs(n);if(a.empty){console.log("No message to delete"),clearInterval(o);return}a.forEach(async c=>{await $(doc(h,"chats",c.id))}),console.log("All messages deleted successfully")}catch(a){console.error("Error deleting message: ",a)}},1e3)})(),{addChat:y,getChats:w,updateChatroom:x,updateUsername:v}}function M(e){return{newli:s=>{const n=formatDistance(s.created_at.toDate(),new Date,{addSuffix:!0}),l=`
            <li class="shadow-lg rounded-lg py-2 px-4">
                <div class="flex justify-between">
                    <h5 class="text-gray-600 font-medium text-sm">${s.username}</h5>
                    <i class="text-gray-300 text-sm">${n}</i>
                </div>

                <p class="text-gray-600 text-sm">${s.message}</p>
            </li>
        `;e.innerHTML+=l},resetli:()=>{e.innerHTML=""}}}const I=document.querySelector(".chatrooms"),_=document.querySelector(".chat-ul"),d=document.querySelector(".chat-form"),m=document.querySelector(".user-form"),f=document.querySelector(".msg"),p=document.querySelector(".roomtitle"),i=localStorage.username?localStorage.username:"Guest";m.username.placeholder=i?`user name is ${i}`:"";const u=A("general",i);p.textContent="General";const g=M(_);d.addEventListener("submit",e=>{e.preventDefault();const t=d.message.value.trim();u.addChat(t).then(()=>d.reset()).catch(r=>console.log(r))});m.addEventListener("submit",e=>{e.preventDefault();const t=m.username.value.trim();u.updateUsername(t),m.reset(),f.innerText=`New name updated to ${t}`,m.username.placeholder=`username is ${t}`,setTimeout(()=>f.innerText="",3e3)});I.addEventListener("click",e=>{e.preventDefault();const t=e.target.closest("button");if(t){g.resetli();const r=t.getAttribute("id"),s=t.querySelector("h3").innerText;p.textContent=s,u.updateChatroom(r),u.getChats(n=>{g.newli(n)})}});u.getChats(e=>{g.newli(e)});
